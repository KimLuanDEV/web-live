<!doctype html>
<html lang="vi">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Viewer</title>
<link rel="stylesheet" href="/style.css"/>
</head>
<body>
<h2>Viewer</h2>
<input id="nameInput" placeholder="Tên hiển thị"/>
<input type="file" id="avatarInput" accept="image/*"/>
<div>
  <img id="ava" width="80"/>
  <b id="nm"></b>
</div>

<script src="/socket.io/socket.io.js"></script>
<script src="/client_helper.js"></script>
<script>
const params = new URLSearchParams(location.search);
const roomId = params.get("room") || "abc123";
const socket = io();

socket.emit("join-room", {
  roomId,
  role: "viewer",
  profile: currentProfile
});

bindProfileUI(socket, roomId, "nameInput", "avatarInput");

socket.on("profile-updated", (d) => {
  if (d.role === "broadcaster"){
    document.getElementById("nm").textContent = d.profile.name;
    document.getElementById("ava").src = getAvatar(d.profile.avatar, d.profile.name);
  }
});

socket.on("host-profile-update", (profile) => {
  const nameEls = document.querySelectorAll(".host-name");
  const avaEls  = document.querySelectorAll(".host-avatar");

  nameEls.forEach(el => el.textContent = profile.name || "Host");
  avaEls.forEach(el => {
    el.src = profile.avatar || `https://i.pravatar.cc/80?u=${profile.name}`;
  });
});


</script>
</body>
</html>
