<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8">
  <title>Lobby - Äang LIVE</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <link rel="stylesheet" href="./style.css">
</head>
<body>
  <div class="wrap">
    <div class="card">
      <div class="topbar">
        <div class="brand">
          <span class="brand__dot"></span>
          <div>
            <div class="brand__title">ğŸŸï¸ Sáº¢NH CHá»œ</div>
            <small>Danh sÃ¡ch host Ä‘ang LIVE</small>
          </div>
        </div>
        <div class="pills">
          <a class="btn" href="./index.html">â• Táº¡o phÃ²ng</a>
          <button id="refresh">ğŸ”„</button>
        </div>
      </div>

      <div id="empty" class="log">ChÆ°a cÃ³ phÃ²ng nÃ o Ä‘ang live.</div>
      <div id="grid" class="lobby-grid"></div>
    </div>
  </div>

<script src="/socket.io/socket.io.js"></script>
<script>
const socket = io();
const grid = document.getElementById("grid");
const empty = document.getElementById("empty");

function pad(n){return String(n).padStart(2,"0")}
function hms(ms){
  const s = Math.floor(ms/1000);
  return `${pad(s/3600|0)}:${pad((s%3600)/60|0)}:${pad(s%60)}`
}

function render(list){
  grid.innerHTML = "";
  empty.style.display = list.length ? "none" : "block";

  list.forEach(r => {
    const a = document.createElement("a");
    a.className = "lobby-item";
    a.href = `/viewer.html?room=${encodeURIComponent(r.roomId)}`;

    const hostName   = r.host?.name   || "Host";
    const hostAvatar = r.host?.avatar || `https://img.freepik.com/premium-vector/live-streaming-text-neon-sign-illustration_189374-265.jpg?w=360`;

    a.innerHTML = `
      <div class="lobby-head">
        <div class="lobby-host">
          <img class="lobby-ava" src="${hostAvatar}" alt="avatar">
          <div class="lobby-hostinfo">
            <div class="lobby-hostname">${hostName}</div>
            <div class="lobby-roomid">ğŸ¥ ${r.roomId}</div>
          </div>
        </div>

        <div class="lobby-badges">
          <span class="badge badge--live">LIVE</span>
          ${r.hasGuest ? `<span class="badge badge--info">Co-host</span>` : ``}
        </div>
      </div>

      <div class="lobby-meta">
        <span class="lobby-chip">ğŸ‘ ${r.viewers}</span>
        <span class="lobby-chip">â± ${hms(Date.now() - r.liveStartTs)}</span>
      </div>

      <div class="lobby-cta">VÃ o xem âœ</div>
    `;
    grid.appendChild(a);
  });
}

socket.emit("lobby-get");
socket.on("lobby-update", d => render(d.rooms || []));
document.getElementById("refresh").onclick = () => socket.emit("lobby-get");
setInterval(() => socket.emit("lobby-get"), 3000);
</script>
</body>
</html>
