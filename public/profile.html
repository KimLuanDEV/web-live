<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <title>Há»“ sÆ¡ cÃ¡ nhÃ¢n</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <link rel="stylesheet" href="/style.css" />
</head>
<body class="profile-page">

<script src="/guard.js"></script>

<div class="container" style="max-width:700px">
  <div class="card">

    <div class="page-header">
      <h1 class="page-title">ğŸ‘¤ Há»“ sÆ¡ cÃ¡ nhÃ¢n</h1>
      <button onclick="location.href='/lobby.html'" class="page-exit-btn">ğŸšª</button>
    </div>

    <hr />

    <!-- AVATAR -->
    <div style="display:flex;gap:16px;align-items:center;flex-wrap:wrap">
      <img id="avatarPreview"
           src="https://img.freepik.com/premium-vector/live-streaming-text-neon-sign-illustration_189374-265.jpg?w=360"
           style="width:96px;height:96px;border-radius:50%;object-fit:cover;border:2px solid var(--stroke)" />

      <div style="flex:1">
        <div class="badge badge--info">áº¢nh Ä‘áº¡i diá»‡n</div>
        <input id="avatarInput" placeholder="URL avatar (hoáº·c Ä‘á»ƒ trá»‘ng)" />
      </div>
    </div>

    <hr />

    <!-- INFO -->
    <div class="row">
      <div class="card">
        <div class="badge">TÃªn hiá»ƒn thá»‹</div>
        <input id="nameInput" />
      </div>

      <div class="card">
        <div class="badge">Level</div>
        <code id="levelText">1</code>
      </div>
    </div>

    <div class="row">
      <div class="card">
        <div class="badge badge--ok">ğŸ’° Coin</div>
        <code id="coinText">0</code>
      </div>

      <div class="card">
        <div class="badge badge--info">User ID</div>
        <code id="uidText">-</code>
      </div>
    </div>

    <hr />

    <button id="saveBtn">ğŸ’¾ LÆ°u thay Ä‘á»•i</button>
    <button onclick="logout()" style="margin-top:8px">ğŸšª ÄÄƒng xuáº¥t</button>

  </div>
</div>

<script type="module">
import { getAuth, saveAuth, logout } from "./auth.js";

const auth = getAuth();
const token = auth.token;

// load profile
async function loadProfile(){
  const res = await fetch("/api/me", {
    headers: { Authorization: token }
  });
  const user = await res.json();

  avatarPreview.src = user.avatar;
  avatarInput.value = user.avatar;
  nameInput.value = user.name;
  coinText.textContent = user.coins;
  levelText.textContent = user.level;
  uidText.textContent = user.id;
}
loadProfile();

// save
saveBtn.onclick = async () => {
  const res = await fetch("/api/profile", {
    method: "POST",
    headers: {
      "Content-Type": "application/json",
      Authorization: token
    },
    body: JSON.stringify({
      name: nameInput.value,
      avatar: avatarInput.value
    })
  });

  const data = await res.json();
  if (!res.ok) return alert("Lá»—i lÆ°u profile");

  // cáº­p nháº­t local auth
  auth.user.name = data.user.name;
  auth.user.avatar = data.user.avatar;
  saveAuth(auth);

  avatarPreview.src = data.user.avatar;
  alert("âœ… ÄÃ£ cáº­p nháº­t há»“ sÆ¡");
};
</script>

</body>
</html>
